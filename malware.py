from tkinter import Tk
from tkinter.filedialog import askopenfilename
from tkinter import messagebox
from tkinter import *
import requests
import os

# Replace your API key
API_KEY = '203366ca5017b6a8221ddefb1e5e904527620250d54ac7aa921188375e55e411'

def scan_file(file_path):
    # Function to scan the file using VirusTotal API  
    url = 'https://www.virustotal.com/vtapi/v2/file/scan'
    params = {'apikey': API_KEY}
    files = {'file': open(file_path, 'rb')}
    response = requests.post(url, files=files, params=params)
    json_response = response.json()
    resource = json_response['resource']
    return resource

def get_file_report(resource):
    # Function to get the file scan report from VirusTotal API
    url = 'https://www.virustotal.com/vtapi/v2/file/report'
    params = {'apikey': API_KEY, 'resource': resource}
    response = requests.get(url, params=params)
    json_response = response.json()
    return json_response

def check_file_for_malware():
    root = Tk()
    root.title("Malware Detection Application")
    # Set the window icon
    root.iconbitmap("download.ico")  # Replace "download.ico" with the actual filename of your icon file

    def show_result():
        # Function to handle the file upload and display the result
        file_path = file_input.get()
        if file_path:
            if file_path.endswith('.zip'):
                resource = scan_file(file_path)
                report = get_file_report(resource)
                if report['response_code'] == 1:
                    if report['positives'] > 0:
                        messagebox.showinfo('Result', f"The file '{file_path}' contains malware.")
                    else:
                        messagebox.showinfo('Result', f"The file '{file_path}' is clean.")
                else:
                    messagebox.showerror('Error', "Unable to retrieve the file scan report.")
            else:
                messagebox.showerror('Error', "Please select a ZIP file.")
        else:
            messagebox.showinfo('Info', "No file selected.")

    # Create the main GUI window
    main_frame = Frame(root)
    main_frame.pack(pady=50)

    logo_frame = Frame(main_frame)
    logo_frame.pack()

    logo_image = PhotoImage(file="")
    logo_label = Label(logo_frame, image=logo_image)
    logo_label.pack()

    title_label = Label(main_frame, text="Hello, I am MalBot!", font=("Arial", 18, "bold"))
    title_label.pack(pady=20)

    instruction_label = Label(main_frame, text="Please upload a ZIP file to inspect.", font=("Arial", 14))
    instruction_label.pack()

    file_frame = Frame(main_frame)
    file_frame.pack(pady=20)

    file_input = StringVar()

    def browse_file():
        # Function to browse and select a ZIP file
        file_path = askopenfilename(filetypes=[('ZIP Files', '*.zip')])
        if file_path:
            file_input.set(file_path)

    browse_button = Button(file_frame, text="Browse", command=browse_file)
    browse_button.pack(side=LEFT, padx=10)

    file_entry = Entry(file_frame, textvariable=file_input, width=40, state="readonly")
    file_entry.pack(side=LEFT)

    upload_button = Button(main_frame, text="Upload File", command=show_result)
    upload_button.pack(pady=20)

    root.mainloop()

if __name__ == '__main__':
    check_file_for_malware()
